<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Troubleshooting a Vim dotnet Plugin - </title>

  <meta name="description" content="problem I had a problem on a new MacBook.
I was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.">
  <meta name="author" content="Willem van Ketwich"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Will\u0027s Blog",
    
    "url": "http:\/\/me.wvk.au\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/me.wvk.au\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/me.wvk.au\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/me.wvk.au\/posts\/troubleshooting-a-dotnet-vim-plugin\/",
          "name": "Troubleshooting a vim dotnet plugin"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Willem van Ketwich"
  },
  "headline": "Troubleshooting a Vim dotnet Plugin",
  "description" : "problem I had a problem on a new MacBook.\nI was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.",
  "inLanguage" : "en",
  "wordCount":  975 ,
  "datePublished" : "2020-02-16T17:34:02",
  "dateModified" : "2020-02-16T17:34:02",
  "image" : "http:\/\/me.wvk.au\/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "http:\/\/me.wvk.au\/posts\/troubleshooting-a-dotnet-vim-plugin\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/me.wvk.au\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/me.wvk.au\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Troubleshooting a Vim dotnet Plugin" />
<meta property="og:description" content="problem I had a problem on a new MacBook.
I was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.">
<meta property="og:url" content="http://me.wvk.au/posts/troubleshooting-a-dotnet-vim-plugin/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Will&#39;s Blog" />

  <meta name="twitter:title" content="Troubleshooting a Vim dotnet Plugin" />
  <meta name="twitter:description" content="problem I had a problem on a new MacBook.
I was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@wilvk" />
  <meta name="twitter:creator" content="@wilvk" />
  <meta name="generator" content="Hugo 0.124.1">
  <link rel="alternate" href="http://me.wvk.au/index.xml" type="application/rss+xml" title="Will&#39;s Blog"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://me.wvk.au/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://me.wvk.au/css/syntax.css" /><link rel="stylesheet" href="http://me.wvk.au/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122351489-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://me.wvk.au/">Will&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="blog" href="http://me.wvk.au/posts/">blog</a>
            </li>
          
        
          
            <li>
              <a title="about" href="http://me.wvk.au/about/">about</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Troubleshooting a Vim dotnet Plugin</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="problem">problem</h2>
<p>I had a problem on a new MacBook.</p>
<p>I was trying to get C# working in Vim. I found a package online called <a href="https://github.com/OmniSharp/omnisharp-vim">omnisharp-vim</a> and decided to give it a go.</p>
<p>After installing the plugin in my <code>.vimrc</code> file, I opened a project file. The syntax highlighting was there, although there was a small problem. Some of the imports wouldn&rsquo;t import:</p>
<p>The project was a <em>dotnet core mvc</em> application and a few of the relevant libraries weren&rsquo;t showing.</p>
<p>Libraries like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.Hosting;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Hosting;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Logging;
</span></span></code></pre></div><p>were showing the ubiquitous:</p>
<pre tabindex="0"><code>The type or namespace cannot be found (are you missing a using directive or an assembly reference?)
</code></pre><!-- raw HTML omitted -->
<h2 id="investigation">investigation</h2>
<p>This was strange to me as I was of the impression that once <em>dotnet core</em> was installed, all the dependencies should be there too. This was my first incorrect assumption that would turn into a rabbit hole of investigation.</p>
<p>I ran the build locally with <code>dotnet build</code> and it built as expected. So what was causing the dependencies to be missing?</p>
<p>Firstly, I looked at the <em>omnisharp-vim</em> code to determine how it works.</p>
<p>The plugin has two options - stdio and http for sending messages from the Language Server to Vim. The plugin called Language Server from the command line and the resulting json is consumed by the plugin to define features of the code.</p>
<p>I decided to blow away all the <em>omnisharp-vim</em> files in my <code>~/.vim/bundle/omnisharp-vim</code> path as well as the <code>~/.cache/omnisharp-roslyn</code> path.</p>
<p>No luck - the same issue occurred.</p>
<p>I began to think that it may have been the version of <em>dotnet core</em> on my laptop so uninstalled all the dotnet components using the dotnet sdk uninstall tool. Then removing all files from <code>/usr/local/share/dotnet</code>, as well as deleting <code>/usr/local/bin/dotnet</code>, and all references to it in my environment.</p>
<p>I reinstalled the <a href="https://formulae.brew.sh/cask/dotnet-sdk">dotnet-sdk</a> from Brew.</p>
<p>The same references were still not being resolved. I couldn&rsquo;t figure it out.</p>
<p>Looking in the path <code>/usr/local/share/dotnet/packs/Microsoft.AspNetCore.App.Ref/3.1.0/ref/netcoreapp3.1/</code> I could actually see the binaries for the missing imports there, yet for some reason <em>omnisharp-vim</em> couldn&rsquo;t find them.</p>
<h2 id="assumptions">assumptions</h2>
<p>The plugin <em>omnisharp-vim</em> installs a package called <a href="https://github.com/OmniSharp/omnisharp-roslyn">omnisharp-roslyn</a> that is used to communicate with the Language Server and uses .Net Roslyn workspaces for defining object types and other things in code.</p>
<p>Stepping back from the issue a bit and thinking about all the parts in the chain, I decided to look into how <em>omnisharp-roslyn</em> actually worked.</p>
<p>Looking around in the source code I could see that there were references to a packaged version of Mono, but not <em>dotnet core</em>. Initially I thought that this was because there may be licencing or other things preventing <em>dotnet core</em> being packaged as well.</p>
<p>I then searched online as it may have been that a <em>dotnet core</em> version of <em>omnisharp-roslyn</em> existed that just hadn&rsquo;t installed for some reason. To my surprise, it turns out that <em>omnisharp-roslyn</em> only targets Mono, as mentioned <a href="https://github.com/OmniSharp/omnisharp-roslyn/issues/1489">here</a>.  This confused me a bit but reading further, this is the only way that full compatibility with both .Net Framework and <em>dotnet core</em> can currently be achieved.</p>
<p>Reading the docs, I could see there was a setting called <code>g:OmniSharp_server_use_mono</code> - my previous assumption was that this was a toggle between Mono and <em>dotnet core</em>.  Reading the docs closer I could see that it toggles between the packaged and system-installed versions of Mono, and not between Mono and <em>dotnet core</em>. A rookie mistake in the new, open source .Net world.</p>
<p><img src="http://me.wvk.au/img/omnisharp.png" alt="connection between omnisharp-vim and mono">
Connection between omnisharp-vim and Mono</p>
<h2 id="solution">solution</h2>
<p>Well, that answered that, so I duly removed all the versions of Mono that I had and did a full reinstall of <em>omnisharp-vim</em>. However, the plugin  was still not resolving.</p>
<p>I was quite perplexed until I read a couple of github issues for the plugin:</p>
<ul>
<li><a href="https://github.com/OmniSharp/omnisharp-roslyn/issues/1693">https://github.com/OmniSharp/omnisharp-roslyn/issues/1693</a></li>
<li><a href="https://github.com/OmniSharp/omnisharp-vim/issues/556">https://github.com/OmniSharp/omnisharp-vim/issues/556</a></li>
</ul>
<p>and realised that there was another system-wide Mono version being referenced by Brew. Doing a system-wide search on any file with the name mono in it (<code>find / -name &quot;*mono*&quot;</code>) showed me there was a Mono Brew cellar still present.</p>
<pre tabindex="0"><code>brew uninstall --force mono
</code></pre><p>Boom. All sorted and back in business.</p>
<!-- raw HTML omitted -->
<h2 id="understanding">understanding</h2>
<p>There are quite a lot of variations of .Net now. It&rsquo;s an entire ecosystem of different flavours - similar to the Java ecosystem (although not as diverse). What I understand now is that these flavors consist of:</p>
<ul>
<li>dotnet core</li>
<li>dotnet-core-sdk</li>
<li>Mono</li>
<li>Mono without asp.net</li>
<li>Legacy .Net Framework</li>
<li>and others</li>
</ul>
<p>There are also a variety of ways these can be downloaded and installed onto a computer, placing copies in different locations in the filesystem, including through:</p>
<ul>
<li>Brew</li>
<li>Direct download</li>
<li>Plugins (such as omnisharp-vim)</li>
<li>IDEs (such as VS Code and Visual Studio for Mac)</li>
<li>and others</li>
</ul>
<p>This all adds to increasing the number of variations and complexity that can lead to error and frustration in the troubleshooting process.</p>
<h2 id="learnings">learnings</h2>
<p>This highlighted to me a few things around:</p>
<p><strong>Name your assumptions</strong>  - My initial assumption was that as it was a <em>dotnet core</em> application, the Language Server would also be targeting <em>dotnet core</em>. This was incorrect. Only by defining what my assumption was could I challenge it and come to a new understanding.</p>
<p><strong>Check your assumptions</strong> - At one stage through this process I was thinking that the <em>omnisharp-vim</em> plugin was broken (which is is, but not in the way I thought). I tried running the plugin on another laptop and it worked. This gave me the confidence to continue troubleshooting and fully understand and resolve the issue.</p>
<p><strong>Read closely</strong> - Read the docs carefully - going back to the <em>omnisharp-vim</em> docs it clearly states that it must be run on Mono. I must have skimmed over this in my initial research of the problem. The problem was that the version I was using didn&rsquo;t have the asp.net libraries.</p>
<p><strong>Have patience</strong> - It took me about a day to figure all this out but through perseverence, there comes a solution.</p>
<p><em>Happy vimming!</em></p>


        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://me.wvk.au/posts/using-volumes-with-docker-in-docker/" data-toggle="tooltip" data-placement="top" title="Using Volumes With Docker in Docker">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="http://me.wvk.au/posts/simple-sos-debugging/" data-toggle="tooltip" data-placement="top" title="Simple Sos Debugging">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="https://github.com/wilvk" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://twitter.com/wilvk" title="Twitter">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/willvk" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Willem van Ketwich
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://me.wvk.au/">Will&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.124.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://me.wvk.au/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://me.wvk.au/js/load-photoswipe.js"></script>









    
  </body>
</html>

