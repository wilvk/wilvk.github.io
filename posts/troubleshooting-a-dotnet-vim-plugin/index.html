<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Troubleshooting a Vim dotnet Plugin - Will&#39;s Blog</title>
<meta name="description" content="problem I had a problem on a new MacBook.
I was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.">

<meta name="author" content="Willem van Ketwich"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Will\u0027s Blog",
    
    "url": "http:\/\/me.wvk.au\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/me.wvk.au\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/me.wvk.au\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/me.wvk.au\/posts\/troubleshooting-a-dotnet-vim-plugin\/",
          "name": "Troubleshooting a vim dotnet plugin"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Willem van Ketwich"
  },
  "headline": "Troubleshooting a Vim dotnet Plugin",
  "description" : "problem I had a problem on a new MacBook.\nI was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.",
  "inLanguage" : "en",
  "wordCount":  975 ,
  "datePublished" : "2020-02-16T17:34:02",
  "dateModified" : "2020-02-16T17:34:02",
  "image" : "http:\/\/me.wvk.au\/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "http:\/\/me.wvk.au\/posts\/troubleshooting-a-dotnet-vim-plugin\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/me.wvk.au\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/me.wvk.au\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Troubleshooting a Vim dotnet Plugin" />
<meta property="og:description" content="problem I had a problem on a new MacBook.
I was trying to get C# working in Vim. I found a package online called omnisharp-vim and decided to give it a go.">
<meta property="og:url" content="http://me.wvk.au/posts/troubleshooting-a-dotnet-vim-plugin/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Will&#39;s Blog" />
<link rel="apple-touch-icon" sizes="180x180" href=" http://me.wvk.au/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://me.wvk.au/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://me.wvk.au/favicon/favicon-16x16.png">


<meta name="generator" content="Hugo 0.124.1">
<link rel="alternate" href="http://me.wvk.au/index.xml" type="application/rss+xml" title="Will&#39;s Blog">
<script src="http://me.wvk.au/js/dark-mode.js"></script><link rel="stylesheet" href="http://me.wvk.au/style.min.css">





<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122351489-2', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </head>
  <body>
    
<div class="container fixed-top mw-100">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-12 col-lg-10 col-xl-10">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top p-0">
        <div class="container">

          <a class="navbar-brand fw-bold" href="http://me.wvk.au/">Will&#39;s Blog</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav mb-2 mb-lg-0 align-items-baseline">
              
              

              <li class="nav-item">

                
                
                
                
                

                <a class="nav-link " title="blog"
                  href="http://me.wvk.au/posts/"> blog</a>
              </li>

              
              
              

              <li class="nav-item">

                
                
                
                
                

                <a class="nav-link " title="about"
                  href="http://me.wvk.au/about/"> about</a>
              </li>

              
              

              <li class="nav-item nav-link">
                <a id="dark-mode-toggle" class="bi bi-moon-stars" role="button"></a>
              </li>

              
            </ul>

            
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>

    









<header class="header-section ">

  <div class="intro-header no-img mt-10">
    <div class="container">
      <div class="row justify-content-center">
        

          
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            

            <div class="posts-heading">
              

              

              
              <h1 class="fw-semibold display-5 lh-1 mb-3"> 
                Troubleshooting a Vim dotnet Plugin
                
              </h1>
              
              

              

              
              
              
            </div>
          </div>
          
        </div>
        
        
    </div>
  </div>
</header>



    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 ">

      <div class="card-image card-image-blog p-0">
        
        


        
      </div>
    </div>

    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
      <article role="main" class="blog-post">
        <h2 id="problem">problem</h2>
<p>I had a problem on a new MacBook.</p>
<p>I was trying to get C# working in Vim. I found a package online called <a href="https://github.com/OmniSharp/omnisharp-vim">omnisharp-vim</a> and decided to give it a go.</p>
<p>After installing the plugin in my <code>.vimrc</code> file, I opened a project file. The syntax highlighting was there, although there was a small problem. Some of the imports wouldn&rsquo;t import:</p>
<p>The project was a <em>dotnet core mvc</em> application and a few of the relevant libraries weren&rsquo;t showing.</p>
<p>Libraries like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.Hosting;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Hosting;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Logging;
</span></span></code></pre></div><p>were showing the ubiquitous:</p>
<pre tabindex="0"><code>The type or namespace cannot be found (are you missing a using directive or an assembly reference?)
</code></pre><!-- raw HTML omitted -->
<h2 id="investigation">investigation</h2>
<p>This was strange to me as I was of the impression that once <em>dotnet core</em> was installed, all the dependencies should be there too. This was my first incorrect assumption that would turn into a rabbit hole of investigation.</p>
<p>I ran the build locally with <code>dotnet build</code> and it built as expected. So what was causing the dependencies to be missing?</p>
<p>Firstly, I looked at the <em>omnisharp-vim</em> code to determine how it works.</p>
<p>The plugin has two options - stdio and http for sending messages from the Language Server to Vim. The plugin called Language Server from the command line and the resulting json is consumed by the plugin to define features of the code.</p>
<p>I decided to blow away all the <em>omnisharp-vim</em> files in my <code>~/.vim/bundle/omnisharp-vim</code> path as well as the <code>~/.cache/omnisharp-roslyn</code> path.</p>
<p>No luck - the same issue occurred.</p>
<p>I began to think that it may have been the version of <em>dotnet core</em> on my laptop so uninstalled all the dotnet components using the dotnet sdk uninstall tool. Then removing all files from <code>/usr/local/share/dotnet</code>, as well as deleting <code>/usr/local/bin/dotnet</code>, and all references to it in my environment.</p>
<p>I reinstalled the <a href="https://formulae.brew.sh/cask/dotnet-sdk">dotnet-sdk</a> from Brew.</p>
<p>The same references were still not being resolved. I couldn&rsquo;t figure it out.</p>
<p>Looking in the path <code>/usr/local/share/dotnet/packs/Microsoft.AspNetCore.App.Ref/3.1.0/ref/netcoreapp3.1/</code> I could actually see the binaries for the missing imports there, yet for some reason <em>omnisharp-vim</em> couldn&rsquo;t find them.</p>
<h2 id="assumptions">assumptions</h2>
<p>The plugin <em>omnisharp-vim</em> installs a package called <a href="https://github.com/OmniSharp/omnisharp-roslyn">omnisharp-roslyn</a> that is used to communicate with the Language Server and uses .Net Roslyn workspaces for defining object types and other things in code.</p>
<p>Stepping back from the issue a bit and thinking about all the parts in the chain, I decided to look into how <em>omnisharp-roslyn</em> actually worked.</p>
<p>Looking around in the source code I could see that there were references to a packaged version of Mono, but not <em>dotnet core</em>. Initially I thought that this was because there may be licencing or other things preventing <em>dotnet core</em> being packaged as well.</p>
<p>I then searched online as it may have been that a <em>dotnet core</em> version of <em>omnisharp-roslyn</em> existed that just hadn&rsquo;t installed for some reason. To my surprise, it turns out that <em>omnisharp-roslyn</em> only targets Mono, as mentioned <a href="https://github.com/OmniSharp/omnisharp-roslyn/issues/1489">here</a>.  This confused me a bit but reading further, this is the only way that full compatibility with both .Net Framework and <em>dotnet core</em> can currently be achieved.</p>
<p>Reading the docs, I could see there was a setting called <code>g:OmniSharp_server_use_mono</code> - my previous assumption was that this was a toggle between Mono and <em>dotnet core</em>.  Reading the docs closer I could see that it toggles between the packaged and system-installed versions of Mono, and not between Mono and <em>dotnet core</em>. A rookie mistake in the new, open source .Net world.</p>
<p><img src="http://me.wvk.au/img/omnisharp.png" alt="connection between omnisharp-vim and mono">
Connection between omnisharp-vim and Mono</p>
<h2 id="solution">solution</h2>
<p>Well, that answered that, so I duly removed all the versions of Mono that I had and did a full reinstall of <em>omnisharp-vim</em>. However, the plugin  was still not resolving.</p>
<p>I was quite perplexed until I read a couple of github issues for the plugin:</p>
<ul>
<li><a href="https://github.com/OmniSharp/omnisharp-roslyn/issues/1693">https://github.com/OmniSharp/omnisharp-roslyn/issues/1693</a></li>
<li><a href="https://github.com/OmniSharp/omnisharp-vim/issues/556">https://github.com/OmniSharp/omnisharp-vim/issues/556</a></li>
</ul>
<p>and realised that there was another system-wide Mono version being referenced by Brew. Doing a system-wide search on any file with the name mono in it (<code>find / -name &quot;*mono*&quot;</code>) showed me there was a Mono Brew cellar still present.</p>
<pre tabindex="0"><code>brew uninstall --force mono
</code></pre><p>Boom. All sorted and back in business.</p>
<!-- raw HTML omitted -->
<h2 id="understanding">understanding</h2>
<p>There are quite a lot of variations of .Net now. It&rsquo;s an entire ecosystem of different flavours - similar to the Java ecosystem (although not as diverse). What I understand now is that these flavors consist of:</p>
<ul>
<li>dotnet core</li>
<li>dotnet-core-sdk</li>
<li>Mono</li>
<li>Mono without asp.net</li>
<li>Legacy .Net Framework</li>
<li>and others</li>
</ul>
<p>There are also a variety of ways these can be downloaded and installed onto a computer, placing copies in different locations in the filesystem, including through:</p>
<ul>
<li>Brew</li>
<li>Direct download</li>
<li>Plugins (such as omnisharp-vim)</li>
<li>IDEs (such as VS Code and Visual Studio for Mac)</li>
<li>and others</li>
</ul>
<p>This all adds to increasing the number of variations and complexity that can lead to error and frustration in the troubleshooting process.</p>
<h2 id="learnings">learnings</h2>
<p>This highlighted to me a few things around:</p>
<p><strong>Name your assumptions</strong>  - My initial assumption was that as it was a <em>dotnet core</em> application, the Language Server would also be targeting <em>dotnet core</em>. This was incorrect. Only by defining what my assumption was could I challenge it and come to a new understanding.</p>
<p><strong>Check your assumptions</strong> - At one stage through this process I was thinking that the <em>omnisharp-vim</em> plugin was broken (which is is, but not in the way I thought). I tried running the plugin on another laptop and it worked. This gave me the confidence to continue troubleshooting and fully understand and resolve the issue.</p>
<p><strong>Read closely</strong> - Read the docs carefully - going back to the <em>omnisharp-vim</em> docs it clearly states that it must be run on Mono. I must have skimmed over this in my initial research of the problem. The problem was that the version I was using didn&rsquo;t have the asp.net libraries.</p>
<p><strong>Have patience</strong> - It took me about a day to figure all this out but through perseverence, there comes a solution.</p>
<p><em>Happy vimming!</em></p>

      </article>
    </div>
  </div>

  
  <div class="row">
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
      <hr class="m-0"/>
    </div>
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-2">
      
    </div>

    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
      
    </div>

    
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 mt-3">
      <div class="card">
        <div class="row no-gutters">
          <div class="col-md-2 ">
            <div class="card-body ">
              
              <img src="http://me.wvk.au/img/bino-about-small.jpg" class="img-responsive img-50 img-round" alt="">
            </div>
          </div>


          <div class="col-md-10">
            <div class="card-body p-1.1">
              <p class="p-0 m-0"><small class="text-muted">Written By</small></p>
              <p class="card-text fs-5 m-0">

                
                Willem van Ketwich
                

              </p>
              
            </div>
          </div>
        </div>
      </div>
    </div>
    

    <div class="col-lg-8 offset-lg-2 col-md-12 offset-md-1 pt-4">
      
      <ul class="list-group list-group-horizontal" style="flex-direction: row">
        
        <li class="list-group-item b-0 p-0">

          <a type="button" class="btn btn-dark" role="button" href="http://me.wvk.au/posts/using-volumes-with-docker-in-docker/"
            data-toggle="tooltip" data-placement="top" title="Using Volumes With Docker in Docker">&larr;
            Previous Post</a>
        </li>
        


        
        <li class="list-group-item ms-auto b-0 p-0">
          <a type="button" class="btn btn-dark" role="button" href="http://me.wvk.au/posts/simple-sos-debugging/"
            data-toggle="tooltip" data-placement="top" title="Simple Sos Debugging">Next Post
            &rarr;</a>
        </li>
        
      </ul>
      
    </div>

    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 pt-4">
    </div>
  </div>
  
</div>

<div class="">
  
  

  

</div>

    


<footer>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ul
          class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row">

          
          <li>
            <a href="https://github.com/wilvk" title="GitHub" target="_blank">
              <span class="mx-2">
                <i class="bi bi-github"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/wilvk" title="Twitter" target="_blank">
              <span class="mx-2">
                <i class="bi bi-twitter"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/willvk" title="LinkedIn" target="_blank">
              <span class="mx-2">
                <i class="bi bi-linkedin"></i>
              </span>
            </a>
          </li>
          
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="credits copyright text-muted">
          
          
          Willem van Ketwich
          
          

          &nbsp;&bull;&nbsp;&copy;
          
          2020
          

          
          &nbsp;&bull;&nbsp;
          <a href="http://me.wvk.au/">Will&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Powered by <a href="https://gohugo.io">Hugo</a> & <a href="https://github.com/binokochumolvarghese/lightbi-hugo">Lightbi.</a>&nbsp; Made with ❤ by <a href="https://binovarghese.com">Bino</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    
  </body>
</html>

